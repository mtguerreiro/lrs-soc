/*
 * @file ipcServerPico.c
 *
 * @brief Server for the inter-processor communication (IPC) library.
 */


//=============================================================================
/*-------------------------------- Includes ---------------------------------*/
//=============================================================================
#include "ipcServerPico.h"

/* Drivers */
#include "pico/stdlib.h"
#include "hardware/irq.h"
#include "pico/multicore.h"

/* Configs */
#include "ocp/hardware/pico/ocpPicoConfig.h"

#include "ocp/ipc/ipcServer.h"
//=============================================================================

//=============================================================================
/*-------------------------------- Prototypes -------------------------------*/
//=============================================================================
//-----------------------------------------------------------------------------
static void ipcServerPicoIrq(void);
//-----------------------------------------------------------------------------
//=============================================================================

//=============================================================================
/*------------------------------- Definitions -------------------------------*/
//=============================================================================

//=============================================================================

//=============================================================================
/*--------------------------------- Globals ---------------------------------*/
//=============================================================================

//=============================================================================

//=============================================================================
/*-------------------------------- Functions --------------------------------*/
//=============================================================================
//-----------------------------------------------------------------------------
void ipcServerPicoInitialize(void){

	multicore_fifo_clear_irq();
    
	irq_set_exclusive_handler(SIO_IRQ_PROC1, ipcServerPicoIrq);
    irq_set_enabled(SIO_IRQ_PROC1, true);
}
//-----------------------------------------------------------------------------
int32_t ipcServerPicoIrqSend(void){

	multicore_fifo_push_blocking(0x01);

	return 0;
}
//-----------------------------------------------------------------------------
//-----------------------------------------------------------------------------
//=============================================================================

//=============================================================================
/*----------------------------- Static functions ----------------------------*/
//=============================================================================
//-----------------------------------------------------------------------------
//-----------------------------------------------------------------------------
//=============================================================================

//=============================================================================
/*----------------------------------- IRQ -----------------------------------*/
//=============================================================================
//-----------------------------------------------------------------------------
static void ipcServerPicoIrq(void){

	multicore_fifo_pop_blocking();
	multicore_fifo_clear_irq();

	ipcServerRequest();
}
//-----------------------------------------------------------------------------
//=============================================================================
