/*
 * ctrace.c
 *
 *  Created on: 21 de ago de 2022
 *      Author: marco
 */

//===========================================================================
/*------------------------------- Includes --------------------------------*/
//===========================================================================
#include "ctrace.h"
//===========================================================================

//===========================================================================
/*------------------------------ Definitions ------------------------------*/
//===========================================================================

//===========================================================================

//===========================================================================
/*------------------------------- Functions -------------------------------*/
//===========================================================================
//---------------------------------------------------------------------------
void ctraceInitialize(ctrace_t *trace, ctraceConfig_t *config){

	ctracememInitialize( &trace->mem, config->mem, config->size );

	trace->data = config->data;
	trace->tags = config->tags;
	trace->tp = config->tags;

	trace->n = 0;
}
//---------------------------------------------------------------------------
void ctraceAdd(ctrace_t *trace, void *src, char *tag){

	uint32_t n;

	n = trace->n;

	trace->data[n] = src;

	while(*tag) *(trace->tp++) = *tag++;
	*(trace->tp++) = 0;

	trace->n++;
}
//---------------------------------------------------------------------------
void ctraceReset(ctrace_t *trace){

	ctracememReset( &trace->mem );
}
//---------------------------------------------------------------------------
void ctraceSetSize(ctrace_t *trace, uint32_t size){

	ctracememSetSize( &trace->mem, size );
}
//---------------------------------------------------------------------------
uint32_t ctraceReadQtyTraces(ctrace_t *trace){

	return trace->n;
}
//---------------------------------------------------------------------------
uint32_t ctraceReadTags(ctrace_t *trace, char *buffer){

	uint32_t k;
	char *p;

	p = trace->tags;
	while( p <= trace->tp ) *buffer++ = *p++;

	k = trace->tp - trace->tags;

	return k;
}
//---------------------------------------------------------------------------
void ctraceSave(ctrace_t *trace){

	uint32_t size;

	size = sizeof(void *) * trace->n;

	ctracememSave( &trace->mem, trace->data, size );
}
//---------------------------------------------------------------------------
//===========================================================================
