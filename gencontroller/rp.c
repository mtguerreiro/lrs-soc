/*
 * rp.c
 *
 *  Created on: 07.10.2022
 *      Author: mguerreiro
 */

//=============================================================================
/*-------------------------------- Includes ---------------------------------*/
//=============================================================================
#include "rp.h"

//=============================================================================

//=============================================================================
/*------------------------------- Definitions -------------------------------*/
//=============================================================================


//=============================================================================

//=============================================================================
/*-------------------------------- Functions --------------------------------*/
//=============================================================================
//-----------------------------------------------------------------------------
void rpInitialize(rpctx_t *rp, rpuint_t maxid, rphandle_t *buffer){

	uint32_t i;

	rp->handle = buffer;
	rp->maxid = maxid;

	for( i = 0; i < maxid; i++ ){
		rp->handle[i] = 0;
	}

}
//-----------------------------------------------------------------------------
rpint_t rpRegisterHandle(rpctx_t *rp, rpid_t id, rphandle_t handle){

	if( id >= rp->maxid ) return RP_ERR_INVALID_ID;

	rp->handle[id] = handle;

	return 0;
}
//-----------------------------------------------------------------------------
rpint_t rpRequest(rpctx_t *rp, void *in, rpuint_t insize, void **out, rpuint_t maxoutsize){

	rpint_t status;

	rpuint_t cmd;
	rpuint_t *p;

	p = (rpuint_t *)( in );
	cmd = *p++;

	if( cmd >= rp->maxid ) return RP_ERR_INVALID_ID;

	if( rp->handle[cmd] == 0 ) return RP_ERR_NO_HANDLE;

	status = rp->handle[cmd]( (void *)( p ), insize - sizeof(rpuint_t), out, maxoutsize);

	return status;
}
//-----------------------------------------------------------------------------
//=============================================================================
